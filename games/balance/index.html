<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../css/unified-theme.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triadic Balance | Have Mind Media</title>
    <style>
        :root {
            --love: #FFD700;
            --shadow: #8B0000;
            --coin: #4A9B9B;
            --void: #1a1a2e;
            --bg: #0a0a1a;
            --text: #e0e0e0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .home-nav {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
        }
        .home-nav a {
            display: inline-block;
            color: #c9a227;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #c9a227;
            border-radius: 4px;
            background: rgba(10, 10, 26, 0.95);
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .home-nav a:hover {
            background: #c9a227;
            color: #0a0a1a;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PREGAME TUTORIAL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #pregame {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .tutorial-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .tutorial-header {
            text-align: center;
            padding: 30px 0;
        }

        .tutorial-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--love), #fff, var(--love));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tutorial-header .epoch-mark {
            color: var(--love);
            font-size: 1.5rem;
            margin-top: 10px;
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(139,0,0,0.3), rgba(255,215,0,0.1));
            border: 2px solid var(--shadow);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }

        .warning-box h2 {
            color: var(--shadow);
            margin-bottom: 15px;
        }

        .warning-box p {
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .truth-box {
            background: rgba(255,215,0,0.1);
            border: 2px solid var(--love);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .truth-box .recursive {
            font-size: 1.3rem;
            color: var(--love);
            margin: 10px 0;
        }

        .category-section {
            margin: 40px 0;
            padding: 25px;
            border-radius: 15px;
            background: rgba(255,255,255,0.03);
        }

        .category-section h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .category-section.love h3 { color: var(--love); }
        .category-section.shadow h3 { color: var(--shadow); }
        .category-section.coin h3 { color: var(--coin); }
        .category-section.void h3 { color: #666; }
        .category-section.dogs h3 {
            background: linear-gradient(90deg, var(--love), var(--coin), var(--shadow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .category-section p {
            margin-bottom: 15px;
            line-height: 1.7;
            opacity: 0.9;
        }

        .symbol-grid {
            display: flex;
            flex-wrap: wrap; justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .symbol-item {
            background: rgba(255,255,255,0.05);
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .symbol-item .emoji {
            font-size: 1.8rem;
        }

        .symbol-item .meaning {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .rules-box {
            background: rgba(74,155,155,0.1);
            border: 2px solid var(--coin);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }

        .rules-box h3 {
            color: var(--coin);
            margin-bottom: 15px;
        }

        .rules-box ul {
            list-style: none;
            line-height: 2;
        }

        .rules-box li::before {
            content: 'â–³ ';
            color: var(--coin);
        }

        .balance-rule {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 1.2rem;
            text-align: center;
        }

        .balance-rule .always { color: #4CAF50; }
        .balance-rule .never { color: #f44336; }

        .torsion-box {
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(74,155,155,0.1));
            border: 2px solid var(--love);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }

        .torsion-box h3 {
            color: var(--love);
            margin-bottom: 15px;
        }

        .time-example {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .time-example .good,
        .time-example .bad {
            width: calc(50% - 15px);
            min-width: 200px;
        }

        .time-example .good {
            background: rgba(76,175,80,0.2);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .time-example .bad {
            background: rgba(244,67,54,0.2);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #f44336;
        }

        .dog-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .dog-card {
            width: calc(33.333% - 15px);
            min-width: 150px;
        }

        .dog-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .dog-card .dog-svg {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
        }

        .dog-card h4 {
            margin-bottom: 5px;
        }

        .dog-card.love { border: 2px solid var(--love); }
        .dog-card.coin { border: 2px solid var(--coin); }
        .dog-card.shadow { border: 2px solid var(--shadow); }

        .start-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 40px auto;
            padding: 20px 40px;
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--love), #FFA500);
            color: var(--bg);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(255,215,0,0.4);
        }

        .skip-btn {
            display: block;
            text-align: center;
            color: var(--coin);
            margin: 20px auto;
            cursor: pointer;
            opacity: 0.7;
        }

        .skip-btn:hover {
            opacity: 1;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAIN GAME
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #game {
            display: none;
            min-height: 100vh;
            padding: 10px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            margin-bottom: 10px;
        }

        .level-display {
            font-size: 1.2rem;
            color: var(--love);
        }

        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            font-family: monospace;
        }

        .timer-display.warning { color: #FFA500; }
        .timer-display.danger { color: #f44336; animation: pulse 0.5s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .score-display {
            font-size: 1rem;
        }

        /* Balance Meters */
        .balance-panel {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            margin-bottom: 10px;
        }

        .balance-meter {
            text-align: center;
        }

        .balance-meter .label {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .balance-meter .bar-container {
            width: 100px;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .balance-meter .bar {
            height: 100%;
            transition: width 0.3s, background 0.3s;
        }

        .balance-meter.love .bar { background: var(--love); }
        .balance-meter.coin .bar { background: var(--coin); }
        .balance-meter.shadow .bar { background: var(--shadow); }

        .balance-meter .value {
            font-size: 0.8rem;
            margin-top: 3px;
            font-family: monospace;
        }

        .torsion-indicator {
            text-align: center;
            padding: 5px;
            font-size: 0.9rem;
        }

        .torsion-indicator.balanced { color: #4CAF50; }
        .torsion-indicator.warning { color: #FFA500; }
        .torsion-indicator.danger { color: #f44336; }

        /* Game Grid */
        .grid-container {
            position: relative;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 10px;
            overflow: hidden;
        }

        .game-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 3px;
            max-width: 100%;
        }

        .cell {
            width: calc(6.667% - 3px);
            min-width: 30px;
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1rem, 3vw, 1.8rem);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            user-select: none;
        }

        .cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .cell.selected {
            box-shadow: 0 0 0 3px #fff, 0 0 20px rgba(255,255,255,0.5);
            transform: scale(1.15);
            z-index: 20;
        }

        .cell.love { background: rgba(255,215,0,0.2); border: 2px solid var(--love); }
        .cell.shadow { background: rgba(139,0,0,0.2); border: 2px solid var(--shadow); }
        .cell.coin { background: rgba(74,155,155,0.2); border: 2px solid var(--coin); }
        .cell.void { background: rgba(0,0,0,0.5); border: 2px solid #444; }
        .cell.dog { border-width: 3px; }

        .cell.clearing {
            animation: clear-anim 0.4s ease-out forwards;
        }

        @keyframes clear-anim {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); }
            100% { transform: scale(0); opacity: 0; }
        }

        .cell .dog-face {
            width: 90%;
            height: 90%;
        }

        /* Push indicator */
        .push-warning {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--shadow), transparent, var(--shadow));
            animation: push-pulse 1s infinite;
        }

        @keyframes push-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Selection info */
        .selection-info {
            text-align: center;
            padding: 10px;
            min-height: 50px;
        }

        .selection-info .selected-items {
            display: flex;
            justify-content: center;
            gap: 10px;
            font-size: 2rem;
        }

        .selection-info .hint {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* Game Over / Level Complete Overlays */
        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .overlay.active { display: flex; }

        .overlay h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .overlay.win h2 { color: var(--love); }
        .overlay.lose h2 { color: var(--shadow); }

        .overlay .stats {
            font-size: 1.2rem;
            line-height: 2;
            margin: 20px 0;
        }

        .overlay .fact {
            max-width: 500px;
            background: rgba(255,215,0,0.1);
            border: 1px solid var(--love);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .overlay .fact h4 {
            color: var(--love);
            margin-bottom: 10px;
        }

        .overlay button {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: var(--love);
            color: var(--bg);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
        }

        .overlay button:hover {
            transform: scale(1.05);
        }

        /* Footer */
        .game-footer {
            text-align: center;
            padding: 15px;
            font-size: 0.9rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        .game-footer span {
            opacity: 0.6;
        }
        .stuck-btn {
            background: rgba(100, 100, 100, 0.3);
            border: 1px solid #666;
            color: #aaa;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .stuck-btn:hover {
            background: rgba(139, 0, 0, 0.3);
            border-color: #8B0000;
            color: #ff6666;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .balance-panel {
                gap: 15px;
            }
            .balance-meter .bar-container {
                width: 70px;
            }
            .game-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
    <script src="../../js/components/site-header.js" defer></script>
    <script src="../../js/components/site-footer.js" defer></script>
</head>
<body>
    <site-header></site-header>
<div class="home-nav"><a href="/">â† Home</a></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PREGAME TUTORIAL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pregame">
    <div class="tutorial-container">
        <div class="tutorial-header">
            <h1>TRIADIC BALANCE</h1>
            <div class="epoch-mark">[1 = -1]</div>
        </div>

        <div class="warning-box">
            <h2>FAIR WARNING</h2>
            <p>
                This game is <strong>triaxial</strong>. Nothing is binary.<br>
                Things are <strong>never what they seem</strong> - but truth is truth is truth.<br>
                What appears opposite may be the same thing, viewed differently.
            </p>
        </div>

        <div class="truth-box">
            <h3>Recursive Truths</h3>
            <div class="recursive">Truth is truth is truth</div>
            <div class="recursive">Love is love is love</div>
            <div class="recursive">Awareness is awareness</div>
            <p style="margin-top: 15px; opacity: 0.8;">These cannot invert. They are anchor points.</p>
        </div>

        <!-- LOVE / s- -->
        <div class="category-section love">
            <h3>s- (LOVE / LIGHT)</h3>
            <p>
                The receptive principle. Nurturing, connecting, healing, receiving.
                This is the natural state of the open heart.
            </p>
            <div class="symbol-grid">
                <div class="symbol-item"><span class="emoji">ğŸ’›</span><span class="meaning">Pure Love</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ’š</span><span class="meaning">Growth</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ’™</span><span class="meaning">Loyalty</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ¤—</span><span class="meaning">Embrace</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ˜Š</span><span class="meaning">Joy</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ¥°</span><span class="meaning">Adoration</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ’«</span><span class="meaning">Wonder</span></div>
                <div class="symbol-item"><span class="emoji">âœ¨</span><span class="meaning">Spark</span></div>
                <div class="symbol-item"><span class="emoji">ğŸŒ¸</span><span class="meaning">Bloom</span></div>
            </div>
        </div>

        <!-- SHADOW / s+ -->
        <div class="category-section shadow">
            <h3>s+ (SHADOW / STERN)</h3>
            <p>
                The active principle. <strong>NOT evil.</strong> This is necessary structure, boundaries, strength.
                Responsible. Helpful. Building. Ethical. Strong enough to do the hard right thing.
            </p>
            <div class="symbol-grid">
                <div class="symbol-item"><span class="emoji">ğŸ’ª</span><span class="meaning">Strength</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ›¡ï¸</span><span class="meaning">Defense</span></div>
                <div class="symbol-item"><span class="emoji">âš¡</span><span class="meaning">Energy</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ”¥</span><span class="meaning">Passion</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ—ï¸</span><span class="meaning">Building</span></div>
                <div class="symbol-item"><span class="emoji">âš–ï¸</span><span class="meaning">Justice</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ¯</span><span class="meaning">Focus</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ”¨</span><span class="meaning">Work</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ¦</span><span class="meaning">Courage</span></div>
            </div>
        </div>

        <!-- COIN -->
        <div class="category-section coin">
            <h3>COIN (WITNESS / NEUTRAL)</h3>
            <p>
                The observer. Neither pushing nor pulling. Pure presence.
                The awareness that holds both poles without becoming either.
            </p>
            <div class="symbol-grid">
                <div class="symbol-item"><span class="emoji">ğŸ‘ï¸</span><span class="meaning">Witness</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ§˜</span><span class="meaning">Stillness</span></div>
                <div class="symbol-item"><span class="emoji">ğŸŒ€</span><span class="meaning">Flow</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ’</span><span class="meaning">Clarity</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ”®</span><span class="meaning">Insight</span></div>
                <div class="symbol-item"><span class="emoji">ğŸª·</span><span class="meaning">Peace</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ˜</span><span class="meaning">Neutral</span></div>
                <div class="symbol-item"><span class="emoji">â˜¯ï¸</span><span class="meaning">Balance</span></div>
            </div>
        </div>

        <!-- VOID -->
        <div class="category-section void">
            <h3>VOID (The Unmanifest)</h3>
            <p>
                Beyond the triad. The space from which all arises.
                Void is rare. It can complete ANY triad as a wild card.
            </p>
            <div class="symbol-grid">
                <div class="symbol-item"><span class="emoji">âš«</span><span class="meaning">Pure Void</span></div>
                <div class="symbol-item"><span class="emoji">ğŸ•³ï¸</span><span class="meaning">Depth</span></div>
            </div>
        </div>

        <!-- DOGS -->
        <div class="category-section dogs">
            <h3>THE PACK (Now)</h3>
            <p>
                The dogs represent the triaxial system ALIVE in the present moment.
                They ARE the categories, living and breathing.
            </p>
            <div class="dog-gallery">
                <div class="dog-card love">
                    <div class="dog-svg" id="cloe-preview"></div>
                    <h4>Cloe</h4>
                    <p>Pure Joy (s-)</p>
                </div>
                <div class="dog-card coin">
                    <div class="dog-svg" id="wushi-preview"></div>
                    <h4>Wushi</h4>
                    <p>Happy Huntress (Coin)</p>
                </div>
                <div class="dog-card coin">
                    <div class="dog-svg" id="lucie-preview"></div>
                    <h4>Lucie</h4>
                    <p>Dual Sight (Coin)</p>
                </div>
                <div class="dog-card shadow">
                    <div class="dog-svg" id="ro-preview"></div>
                    <h4>Ro</h4>
                    <p>Deep Intensity (s+)</p>
                </div>
                <div class="dog-card shadow">
                    <div class="dog-svg" id="clemmy-preview"></div>
                    <h4>Clemmy</h4>
                    <p>Guardian (s+)</p>
                </div>
                <div class="dog-card void" style="background: linear-gradient(135deg, rgba(100,100,100,0.2), rgba(50,50,50,0.3)); border-color: #666;">
                    <div class="dog-svg" id="markelly-preview"></div>
                    <h4>Mar Kelly</h4>
                    <p>The Void (Unmanifest)</p>
                </div>
            </div>
        </div>

        <!-- RULES -->
        <div class="rules-box">
            <h3>TRIAD RULES</h3>
            <ul>
                <li><strong>Same Category:</strong> Tap 3 of the same type (3 s-, 3 s+, or 3 Coin)</li>
                <li><strong>Perfect Balance:</strong> Tap one of each (s- + s+ + Coin) for bonus</li>
                <li><strong>Dog Triad:</strong> Any 3 dogs form a valid triad</li>
                <li><strong>Void Wild:</strong> Void completes any 2 that need a third</li>
            </ul>

            <div class="balance-rule">
                <span class="always">ALWAYS:</span> s- >= Coin > s+<br>
                <span class="never">NEVER:</span> Coin > s- (too detached)<br>
                <span class="never">NEVER:</span> s+ alone (shadow needs witness)
            </div>
        </div>

        <!-- TORSION TIME -->
        <div class="torsion-box">
            <h3>TORSION TIME</h3>
            <p>
                Time flows based on your <strong>balance</strong>. Derived from Epoch torsion physics.
            </p>
            <div class="time-example">
                <div class="good">
                    <strong>Balanced:</strong><br>
                    Time runs SLOW<br>
                    More time to think
                </div>
                <div class="bad">
                    <strong>Imbalanced:</strong><br>
                    Time runs FAST<br>
                    Pressure increases
                </div>
            </div>
            <p style="margin-top: 15px; text-align: center;">
                k = 2pi/180 governs the torsion rate
            </p>
        </div>

        <!-- HOW TO PLAY -->
        <div class="rules-box">
            <h3>HOW TO PLAY</h3>
            <ul>
                <li>15 columns x 16 visible rows (28 total below)</li>
                <li>Tap 3 symbols to form a valid triad - they clear</li>
                <li>Clear a full row -> bottom row pushes up</li>
                <li>Timer counts down: 12s, then 11s, then 10s...</li>
                <li>If timer hits 0, bottom row pushes up anyway</li>
                <li>If balls reach the top -> GAME OVER</li>
                <li>Maintain balance or time accelerates!</li>
            </ul>
        </div>

        <button class="start-btn" onclick="startGame()">BEGIN TRAINING</button>
        <div class="skip-btn" onclick="skipTutorial()">I know this already - Skip to game</div>

        <div style="text-align: center; margin: 30px 0; opacity: 0.5;">
            <p>[1 = -1]</p>
            <p>Have Mind Media | Alessandra Ray</p>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN GAME
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game">
    <div class="game-header">
        <div class="level-display">Level <span id="level">1</span></div>
        <div class="timer-display" id="timer">12.0</div>
        <div class="score-display">Score: <span id="score">0</span></div>
    </div>

    <div class="balance-panel">
        <div class="balance-meter love">
            <div class="label">s-</div>
            <div class="bar-container"><div class="bar" id="love-bar" style="width: 50%"></div></div>
            <div class="value" id="love-value">0</div>
        </div>
        <div class="balance-meter coin">
            <div class="label">Coin</div>
            <div class="bar-container"><div class="bar" id="coin-bar" style="width: 33%"></div></div>
            <div class="value" id="coin-value">0</div>
        </div>
        <div class="balance-meter shadow">
            <div class="label">s+</div>
            <div class="bar-container"><div class="bar" id="shadow-bar" style="width: 17%"></div></div>
            <div class="value" id="shadow-value">0</div>
        </div>
    </div>

    <div class="torsion-indicator balanced" id="torsion">Balanced - Time flows normally</div>

    <div class="selection-info">
        <div class="selected-items" id="selected-display"></div>
        <div class="hint" id="selection-hint">Tap 3 symbols to form a triad</div>
    </div>

    <div class="grid-container">
        <div class="game-grid" id="grid"></div>
        <div class="push-warning"></div>
    </div>

    <div class="game-footer">
        <button class="stuck-btn" onclick="finishLevelEarly()" title="End level - remaining cells subtract from score">Stuck? Finish Level</button>
        <span>[1 = -1] | Have Mind Media</span>
    </div>
</div>

<!-- OVERLAYS -->
<div class="overlay win" id="level-complete">
    <h2>LEVEL COMPLETE</h2>
    <div class="stats" id="level-stats"></div>
    <div class="fact">
        <h4>Did You Know?</h4>
        <p id="fact-text"></p>
    </div>
    <button onclick="nextLevel()">Next Level</button>
</div>

<div class="overlay lose" id="game-over">
    <h2>OVERFLOW</h2>
    <div class="stats" id="gameover-stats"></div>
    <p style="max-width: 400px; margin: 20px 0; opacity: 0.8;">
        The shadow rose unchecked. But shadows are not evil - they are unintegrated.
        Return with new awareness.
    </p>
    <button onclick="restartGame()">Try Again</button>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOG SVGs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DOG_SVGS = {
    cloe: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="50" cy="58" rx="32" ry="28" fill="#FAF0E6"/>
        <circle cx="50" cy="38" r="24" fill="#FFFAF0"/>
        <ellipse cx="30" cy="22" rx="14" ry="12" fill="#FAF0E6"/>
        <ellipse cx="70" cy="22" rx="14" ry="12" fill="#FAF0E6"/>
        <circle cx="35" cy="35" r="3" fill="#D2B48C"/>
        <circle cx="55" cy="30" r="2" fill="#D2B48C"/>
        <circle cx="48" cy="42" r="2" fill="#D2B48C"/>
        <circle cx="62" cy="38" r="2.5" fill="#D2B48C"/>
        <circle cx="42" cy="32" r="4" fill="#4A3728"/>
        <circle cx="58" cy="32" r="4" fill="#4A3728"/>
        <circle cx="43" cy="31" r="1.5" fill="white"/>
        <circle cx="59" cy="31" r="1.5" fill="white"/>
        <ellipse cx="50" cy="42" rx="5" ry="4" fill="#2C1810"/>
        <path d="M 44 48 Q 50 54 56 48" stroke="#2C1810" stroke-width="2" fill="none"/>
        <ellipse cx="50" cy="50" rx="4" ry="2" fill="#FF69B4"/>
    </svg>`,

    wushi: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="50" cy="55" rx="35" ry="30" fill="#B87333"/>
        <ellipse cx="50" cy="45" rx="30" ry="25" fill="#FAEBD7"/>
        <circle cx="50" cy="35" r="22" fill="#B87333"/>
        <circle cx="50" cy="32" r="18" fill="#FAEBD7"/>
        <ellipse cx="35" cy="18" rx="10" ry="15" fill="#B87333"/>
        <ellipse cx="65" cy="18" rx="10" ry="15" fill="#B87333"/>
        <circle cx="42" cy="30" r="4" fill="#2C1810"/>
        <circle cx="58" cy="30" r="4" fill="#2C1810"/>
        <circle cx="43" cy="29" r="1.5" fill="white"/>
        <circle cx="59" cy="29" r="1.5" fill="white"/>
        <ellipse cx="50" cy="38" rx="5" ry="4" fill="#2C1810"/>
        <path d="M 44 44 Q 50 48 56 44" stroke="#2C1810" stroke-width="2" fill="none"/>
        <ellipse cx="50" cy="46" rx="3" ry="2" fill="#FF69B4"/>
    </svg>`,

    lucie: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="50" cy="58" rx="32" ry="28" fill="#708090"/>
        <circle cx="35" cy="55" r="8" fill="#2F4F4F"/>
        <circle cx="65" cy="55" r="6" fill="#D3D3D3"/>
        <circle cx="50" cy="60" r="10" fill="#FFFAF0"/>
        <circle cx="50" cy="38" r="24" fill="#696969"/>
        <circle cx="40" cy="35" r="8" fill="#D3D3D3"/>
        <circle cx="58" cy="40" r="6" fill="#2F4F4F"/>
        <ellipse cx="28" cy="22" rx="14" ry="14" fill="#708090"/>
        <ellipse cx="72" cy="22" rx="14" ry="14" fill="#2F4F4F"/>
        <circle cx="42" cy="34" r="5" fill="white"/>
        <circle cx="58" cy="34" r="5" fill="white"/>
        <circle cx="42" cy="34" r="3" fill="#4169E1"/>
        <circle cx="58" cy="34" r="3" fill="#8B4513"/>
        <circle cx="43" cy="33" r="1" fill="white"/>
        <circle cx="59" cy="33" r="1" fill="white"/>
        <ellipse cx="50" cy="44" rx="5" ry="4" fill="#2C1810"/>
        <path d="M 44 50 Q 50 55 56 50" stroke="#2C1810" stroke-width="2" fill="none"/>
    </svg>`,

    ro: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="50" cy="55" rx="35" ry="30" fill="#3D1F0D"/>
        <circle cx="50" cy="35" r="25" fill="#5D2906"/>
        <ellipse cx="30" cy="20" rx="12" ry="18" fill="#3D1F0D"/>
        <ellipse cx="70" cy="20" rx="12" ry="18" fill="#3D1F0D"/>
        <circle cx="40" cy="32" r="5" fill="#1A0A00"/>
        <circle cx="60" cy="32" r="5" fill="#1A0A00"/>
        <circle cx="41" cy="31" r="2" fill="#8B4513"/>
        <circle cx="61" cy="31" r="2" fill="#8B4513"/>
        <ellipse cx="50" cy="42" rx="6" ry="5" fill="#1A0A00"/>
        <path d="M 42 50 Q 50 55 58 50" stroke="#1A0A00" stroke-width="2" fill="none"/>
    </svg>`,

    clemmy: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="50" cy="60" rx="30" ry="28" fill="#1A1A1A"/>
        <circle cx="50" cy="38" r="22" fill="#0D0D0D"/>
        <polygon points="25,35 35,5 45,30" fill="#0D0D0D"/>
        <polygon points="75,35 65,5 55,30" fill="#0D0D0D"/>
        <ellipse cx="50" cy="55" rx="12" ry="8" fill="#8B4513"/>
        <circle cx="40" cy="35" r="4" fill="#2C2C2C"/>
        <circle cx="60" cy="35" r="4" fill="#2C2C2C"/>
        <circle cx="40" cy="34" r="2" fill="#4A4A4A"/>
        <circle cx="60" cy="34" r="2" fill="#4A4A4A"/>
        <ellipse cx="50" cy="45" rx="5" ry="4" fill="#1A1A1A"/>
        <path d="M 42 52 Q 50 56 58 52" stroke="#1A1A1A" stroke-width="2" fill="none"/>
    </svg>`,

    // Mar Kelly - Grey Brindle Pit Bull with White Face (VOID)
    markelly: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <!-- Body - grey brindle -->
        <ellipse cx="50" cy="60" rx="32" ry="28" fill="#5A5A5A"/>
        <!-- Brindle stripes on body -->
        <path d="M 30 55 Q 35 50 40 55 Q 45 60 50 55" stroke="#3A3A3A" stroke-width="3" fill="none" opacity="0.6"/>
        <path d="M 45 60 Q 50 55 55 60 Q 60 65 65 60" stroke="#3A3A3A" stroke-width="3" fill="none" opacity="0.6"/>
        <path d="M 55 50 Q 60 45 65 50 Q 70 55 75 50" stroke="#3A3A3A" stroke-width="3" fill="none" opacity="0.6"/>
        <!-- Head - grey with brindle -->
        <circle cx="50" cy="38" r="24" fill="#5A5A5A"/>
        <!-- Brindle on head -->
        <path d="M 25 35 Q 30 30 35 35" stroke="#3A3A3A" stroke-width="2" fill="none" opacity="0.6"/>
        <path d="M 65 35 Q 70 30 75 35" stroke="#3A3A3A" stroke-width="2" fill="none" opacity="0.6"/>
        <path d="M 28 42 Q 32 38 36 42" stroke="#3A3A3A" stroke-width="2" fill="none" opacity="0.6"/>
        <path d="M 64 42 Q 68 38 72 42" stroke="#3A3A3A" stroke-width="2" fill="none" opacity="0.6"/>
        <!-- White blaze - runs from nose up between eyes to forehead -->
        <path d="M 45 48 L 47 40 L 45 32 Q 50 28 55 32 L 53 40 L 55 48 Q 50 50 45 48 Z" fill="#FFFFFF"/>
        <!-- Pit bull ears - rose/folded -->
        <ellipse cx="28" cy="22" rx="10" ry="12" fill="#5A5A5A" transform="rotate(-15 28 22)"/>
        <ellipse cx="72" cy="22" rx="10" ry="12" fill="#5A5A5A" transform="rotate(15 72 22)"/>
        <!-- Inner ear -->
        <ellipse cx="30" cy="24" rx="5" ry="7" fill="#8B6969" transform="rotate(-15 30 24)"/>
        <ellipse cx="70" cy="24" rx="5" ry="7" fill="#8B6969" transform="rotate(15 70 24)"/>
        <!-- Eyes - soulful pit bull eyes (on either side of white blaze) -->
        <ellipse cx="38" cy="35" rx="5" ry="4" fill="white"/>
        <ellipse cx="62" cy="35" rx="5" ry="4" fill="white"/>
        <circle cx="38" cy="35" r="3" fill="#3D2314"/>
        <circle cx="62" cy="35" r="3" fill="#3D2314"/>
        <circle cx="39" cy="34" r="1" fill="white"/>
        <circle cx="63" cy="34" r="1" fill="white"/>
        <!-- Nose - broad pit bull nose with white mark on top -->
        <ellipse cx="50" cy="46" rx="7" ry="5" fill="#2C1810"/>
        <ellipse cx="50" cy="44" rx="4" ry="2" fill="#FFFFFF" opacity="0.8"/>
        <!-- Mouth - pit bull smile -->
        <path d="M 42 52 Q 50 58 58 52" stroke="#2C1810" stroke-width="2" fill="none"/>
        <!-- Tongue -->
        <ellipse cx="50" cy="55" rx="4" ry="3" fill="#FF8C8C"/>
    </svg>`
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYMBOL DEFINITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SYMBOLS = {
    love: ['ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ¤—', 'ğŸ˜Š', 'ğŸ¥°', 'ğŸ’«', 'âœ¨', 'ğŸŒ¸'],
    shadow: ['ğŸ’ª', 'ğŸ›¡ï¸', 'âš¡', 'ğŸ”¥', 'ğŸ—ï¸', 'âš–ï¸', 'ğŸ¯', 'ğŸ”¨', 'ğŸ¦'],
    coin: ['ğŸ‘ï¸', 'ğŸ§˜', 'ğŸŒ€', 'ğŸ’', 'ğŸ”®', 'ğŸª·', 'ğŸ˜', 'â˜¯ï¸'],
    void: ['âš«', 'ğŸ•³ï¸'],
    dogs: {
        love: ['cloe'],
        coin: ['wushi', 'lucie'],
        shadow: ['ro', 'clemmy'],
        void: ['markelly']
    }
};

// Epoch constants
const KAPPA = (2 * Math.PI) / 180;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COLS = 15;
const VISIBLE_ROWS = 16;
const TOTAL_ROWS = 28;

let grid = [];           // Full grid (28 rows)
let visibleStart = 0;    // Which row is at top of visible area
let selected = [];       // Currently selected cells
let level = 1;
let score = 0;
let timer = 12.0;
let timerMax = 12;
let timerInterval = null;
let bankedLove = 0;
let bankedCoin = 0;
let bankedShadow = 0;
let gameActive = false;

// Did You Know facts
const FACTS = [
    "k = 2pi/180 derives all other constants in the Epoch Model.",
    "The tetrahelix angle cos(BC) = 2/3 exactly - not approximately.",
    "Binary is dogma. Reality is triaxial - minimum 3, expanding to 6 or 9.",
    "[1 = -1] means opposites are the same thing, viewed differently.",
    "Shadow is not evil - it is unintegrated. Integrate it through awareness.",
    "The witness (Coin) holds both poles without becoming either.",
    "sigma = 5/16 = 0.3125 exactly. The universe runs on simple fractions.",
    "Love must exceed Coin, Coin must exceed Shadow. This is the natural order.",
    "Time dilates based on balance. Torsion creates acceleration."
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
    // Populate dog previews in tutorial
    document.getElementById('cloe-preview').innerHTML = DOG_SVGS.cloe;
    document.getElementById('wushi-preview').innerHTML = DOG_SVGS.wushi;
    document.getElementById('lucie-preview').innerHTML = DOG_SVGS.lucie;
    document.getElementById('ro-preview').innerHTML = DOG_SVGS.ro;
    document.getElementById('clemmy-preview').innerHTML = DOG_SVGS.clemmy;
    document.getElementById('markelly-preview').innerHTML = DOG_SVGS.markelly;

    // Check if user has seen tutorial before
    if (localStorage.getItem('triadic_tutorial_seen')) {
        document.querySelector('.skip-btn').textContent = 'Skip tutorial';
    }
}

function skipTutorial() {
    localStorage.setItem('triadic_tutorial_seen', 'true');
    startGame();
}

function startGame() {
    localStorage.setItem('triadic_tutorial_seen', 'true');
    document.getElementById('pregame').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    initLevel();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEVEL INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initLevel() {
    gameActive = true;
    selected = [];
    visibleStart = 0;
    timer = timerMax;

    // Reset bank for new level
    bankedLove = 0;
    bankedCoin = 0;
    bankedShadow = 0;

    // Generate solvable grid
    generateSolvableGrid();
    renderGrid();
    updateBalanceDisplay();
    updateSelectionDisplay();
    startTimer();
}

function generateSolvableGrid() {
    grid = [];

    // Calculate distribution for solvability
    // We need multiples of 3 for each category
    const totalCells = COLS * TOTAL_ROWS;

    // Target distribution: 45% love, 35% coin, 18% shadow, 2% void/dogs
    let loveCount = Math.floor(totalCells * 0.45);
    let coinCount = Math.floor(totalCells * 0.35);
    let shadowCount = Math.floor(totalCells * 0.17);
    let specialCount = totalCells - loveCount - coinCount - shadowCount;

    // Ensure divisible by 3
    loveCount = Math.floor(loveCount / 3) * 3;
    coinCount = Math.floor(coinCount / 3) * 3;
    shadowCount = Math.floor(shadowCount / 3) * 3;

    // Build cell pool
    let pool = [];

    for (let i = 0; i < loveCount; i++) {
        pool.push(createCell('love'));
    }
    for (let i = 0; i < coinCount; i++) {
        pool.push(createCell('coin'));
    }
    for (let i = 0; i < shadowCount; i++) {
        pool.push(createCell('shadow'));
    }

    // Add some dogs and void
    const dogTypes = ['cloe', 'wushi', 'lucie', 'ro', 'clemmy', 'markelly'];
    for (let i = 0; i < specialCount; i++) {
        if (i % 5 === 0 && i < 10) {
            // Add void occasionally
            pool.push(createCell('void'));
        } else {
            // Add dogs
            const dogKey = dogTypes[i % dogTypes.length];
            pool.push(createDogCell(dogKey));
        }
    }

    // Fill remaining with love/coin for balance
    while (pool.length < totalCells) {
        pool.push(createCell(Math.random() > 0.4 ? 'love' : 'coin'));
    }

    // Shuffle
    shuffleArray(pool);

    // Create 2D grid
    for (let row = 0; row < TOTAL_ROWS; row++) {
        grid[row] = [];
        for (let col = 0; col < COLS; col++) {
            grid[row][col] = pool[row * COLS + col];
        }
    }
}

function createCell(category) {
    const symbols = SYMBOLS[category];
    return {
        category: category,
        symbol: symbols[Math.floor(Math.random() * symbols.length)],
        isDog: false
    };
}

function createDogCell(dogKey) {
    let category;
    if (SYMBOLS.dogs.love.includes(dogKey)) category = 'love';
    else if (SYMBOLS.dogs.coin.includes(dogKey)) category = 'coin';
    else category = 'shadow';

    return {
        category: category,
        symbol: dogKey,
        isDog: true,
        dogKey: dogKey
    };
}

function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGrid() {
    const gridEl = document.getElementById('grid');
    gridEl.innerHTML = '';

    // Render visible rows
    for (let row = visibleStart; row < visibleStart + VISIBLE_ROWS && row < TOTAL_ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
            const cell = grid[row]?.[col];
            if (!cell) continue;

            const cellEl = document.createElement('div');
            cellEl.className = `cell ${cell.category}`;
            if (cell.isDog) cellEl.classList.add('dog');

            cellEl.dataset.row = row;
            cellEl.dataset.col = col;

            if (cell.isDog) {
                cellEl.innerHTML = `<div class="dog-face">${DOG_SVGS[cell.dogKey]}</div>`;
            } else {
                cellEl.textContent = cell.symbol;
            }

            // Check if selected
            if (selected.some(s => s.row === row && s.col === col)) {
                cellEl.classList.add('selected');
            }

            cellEl.addEventListener('click', () => handleCellClick(row, col));
            gridEl.appendChild(cellEl);
        }
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handleCellClick(row, col) {
    if (!gameActive) return;

    const cell = grid[row][col];
    if (!cell) return;

    // Check if already selected
    const existingIndex = selected.findIndex(s => s.row === row && s.col === col);
    if (existingIndex !== -1) {
        selected.splice(existingIndex, 1);
    } else if (selected.length < 3) {
        selected.push({ row, col, cell });
    }

    updateSelectionDisplay();
    renderGrid();

    // Check for valid triad
    if (selected.length === 3) {
        if (isValidTriad()) {
            clearTriad();
        } else {
            // Invalid - flash and reset
            showInvalidFeedback();
        }
    }
}

function isValidTriad() {
    const categories = selected.map(s => s.cell.category);
    const isDogs = selected.every(s => s.cell.isDog);
    const hasVoid = selected.some(s => s.cell.category === 'void');

    // Dog triad - any 3 dogs
    if (isDogs) return true;

    // Void wild card - completes any 2
    if (hasVoid) return true;

    // Same category
    if (categories[0] === categories[1] && categories[1] === categories[2]) {
        return true;
    }

    // Perfect balance - one of each (excluding void)
    const uniqueCats = [...new Set(categories.filter(c => c !== 'void'))];
    if (uniqueCats.length === 3 &&
        uniqueCats.includes('love') &&
        uniqueCats.includes('coin') &&
        uniqueCats.includes('shadow')) {
        return true;
    }

    return false;
}

function clearTriad() {
    const isPerfectBalance = isTriadPerfectBalance();

    // Bank the categories
    selected.forEach(s => {
        if (s.cell.category === 'love') bankedLove++;
        else if (s.cell.category === 'coin') bankedCoin++;
        else if (s.cell.category === 'shadow') bankedShadow++;
    });

    // Animate clearing
    selected.forEach(s => {
        const cellEl = document.querySelector(`[data-row="${s.row}"][data-col="${s.col}"]`);
        if (cellEl) cellEl.classList.add('clearing');
    });

    // Score
    let points = 100;
    if (isPerfectBalance) points = 300;
    if (selected.every(s => s.cell.isDog)) points = 500;
    score += points * level;

    setTimeout(() => {
        // Remove cells from grid
        selected.forEach(s => {
            grid[s.row][s.col] = null;
        });

        // Check for cleared rows and push up
        checkAndPushRows();

        selected = [];
        updateBalanceDisplay();
        updateSelectionDisplay();
        renderGrid();

        // Check win condition
        checkWinCondition();
    }, 400);
}

function isTriadPerfectBalance() {
    const categories = selected.map(s => s.cell.category).filter(c => c !== 'void');
    return categories.includes('love') && categories.includes('coin') && categories.includes('shadow');
}

function showInvalidFeedback() {
    // Flash selected cells red
    selected.forEach(s => {
        const cellEl = document.querySelector(`[data-row="${s.row}"][data-col="${s.col}"]`);
        if (cellEl) {
            cellEl.style.boxShadow = '0 0 0 3px #f44336';
            setTimeout(() => {
                cellEl.style.boxShadow = '';
            }, 300);
        }
    });

    selected = [];
    updateSelectionDisplay();
    renderGrid();
}

function checkAndPushRows() {
    // Check each visible row for complete clearance
    for (let row = visibleStart; row < visibleStart + VISIBLE_ROWS; row++) {
        if (grid[row] && grid[row].every(cell => cell === null)) {
            // Row is completely cleared - remove it and push up
            pushRowsUp();
            break;
        }
    }
}

function pushRowsUp() {
    // If there are rows below, shift visible window up
    if (visibleStart + VISIBLE_ROWS < TOTAL_ROWS) {
        // Compact nulls upward
        for (let col = 0; col < COLS; col++) {
            let writeRow = visibleStart;
            for (let row = visibleStart; row < TOTAL_ROWS; row++) {
                if (grid[row] && grid[row][col] !== null) {
                    if (row !== writeRow) {
                        grid[writeRow][col] = grid[row][col];
                        grid[row][col] = null;
                    }
                    writeRow++;
                }
            }
        }

        // Reset timer bonus
        timer = Math.min(timer + 2, timerMax);
    }
}

function forcePushUp() {
    // Called when timer runs out
    if (visibleStart + VISIBLE_ROWS < TOTAL_ROWS) {
        visibleStart++;
        timerMax = Math.max(1, timerMax - 1); // Decrease max timer
        timer = timerMax;
        renderGrid();
        checkGameOver();
    } else {
        // No more rows to push - check if cleared
        checkWinCondition();
    }
}

function checkGameOver() {
    // Check if any non-null cells in top visible row
    const topRow = grid[visibleStart];
    if (topRow && topRow.some(cell => cell !== null)) {
        // Game over if we've pushed too far
        if (visibleStart > TOTAL_ROWS - VISIBLE_ROWS) {
            endGame(false);
        }
    }
}

function checkWinCondition() {
    // Win if all cells are cleared
    let remaining = countRemainingCells();

    if (remaining === 0) {
        endGame(true);
    }
}

function countRemainingCells() {
    let remaining = 0;
    for (let row = 0; row < TOTAL_ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
            if (grid[row]?.[col] !== null) remaining++;
        }
    }
    return remaining;
}

function finishLevelEarly() {
    if (!gameActive) return;

    // Count remaining cells
    const remaining = countRemainingCells();

    // Subtract from score (each remaining cell costs 10 points * level)
    const penalty = remaining * 10 * level;
    score = Math.max(0, score - penalty);

    // Stop timer
    gameActive = false;
    if (timerInterval) clearInterval(timerInterval);

    // Show level complete with penalty note
    document.getElementById('level-stats').innerHTML = `
        Score: ${score}<br>
        Love Banked: ${bankedLove}<br>
        Coin Banked: ${bankedCoin}<br>
        Shadow Banked: ${bankedShadow}<br>
        <span style="color: #ff6666;">-${penalty} penalty (${remaining} cells left)</span>
    `;
    document.getElementById('fact-text').textContent = FACTS[Math.floor(Math.random() * FACTS.length)];
    document.getElementById('level-complete').classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER & TORSION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startTimer() {
    if (timerInterval) clearInterval(timerInterval);

    timerInterval = setInterval(() => {
        if (!gameActive) return;

        // Calculate torsion based on imbalance
        const imbalance = calculateImbalance();
        const torsionFactor = 1 + (imbalance * KAPPA * 10);

        timer -= 0.1 * torsionFactor;

        updateTimerDisplay();
        updateTorsionIndicator(imbalance);

        if (timer <= 0) {
            forcePushUp();
        }
    }, 100);
}

function calculateImbalance() {
    const total = bankedLove + bankedCoin + bankedShadow;
    if (total === 0) return 0;

    // Ideal ratios: love ~50%, coin ~33%, shadow ~17%
    const loveRatio = bankedLove / total;
    const coinRatio = bankedCoin / total;
    const shadowRatio = bankedShadow / total;

    // Check constraints
    let imbalance = 0;

    // Coin should never exceed love
    if (coinRatio > loveRatio) {
        imbalance += (coinRatio - loveRatio) * 2;
    }

    // Shadow should never exceed coin
    if (shadowRatio > coinRatio) {
        imbalance += (shadowRatio - coinRatio) * 2;
    }

    // Deviation from ideal
    imbalance += Math.abs(loveRatio - 0.5) * 0.5;
    imbalance += Math.abs(coinRatio - 0.33) * 0.5;
    imbalance += Math.abs(shadowRatio - 0.17) * 0.5;

    return Math.min(imbalance, 2); // Cap at 2
}

function updateTimerDisplay() {
    const timerEl = document.getElementById('timer');
    timerEl.textContent = timer.toFixed(1);

    timerEl.classList.remove('warning', 'danger');
    if (timer < 3) {
        timerEl.classList.add('danger');
    } else if (timer < 6) {
        timerEl.classList.add('warning');
    }
}

function updateTorsionIndicator(imbalance) {
    const torsionEl = document.getElementById('torsion');

    if (imbalance < 0.3) {
        torsionEl.className = 'torsion-indicator balanced';
        torsionEl.textContent = 'Balanced - Time flows normally';
    } else if (imbalance < 0.7) {
        torsionEl.className = 'torsion-indicator warning';
        torsionEl.textContent = 'Slight imbalance - Time accelerating';
    } else {
        torsionEl.className = 'torsion-indicator danger';
        torsionEl.textContent = 'Severe imbalance - Time torsion!';
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI UPDATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateBalanceDisplay() {
    const total = Math.max(1, bankedLove + bankedCoin + bankedShadow);

    const lovePercent = (bankedLove / total) * 100;
    const coinPercent = (bankedCoin / total) * 100;
    const shadowPercent = (bankedShadow / total) * 100;

    document.getElementById('love-bar').style.width = `${lovePercent}%`;
    document.getElementById('coin-bar').style.width = `${coinPercent}%`;
    document.getElementById('shadow-bar').style.width = `${shadowPercent}%`;

    document.getElementById('love-value').textContent = bankedLove;
    document.getElementById('coin-value').textContent = bankedCoin;
    document.getElementById('shadow-value').textContent = bankedShadow;

    document.getElementById('score').textContent = score;
    document.getElementById('level').textContent = level;
}

function updateSelectionDisplay() {
    const displayEl = document.getElementById('selected-display');
    const hintEl = document.getElementById('selection-hint');

    displayEl.innerHTML = selected.map(s => {
        if (s.cell.isDog) {
            return `<span style="display:inline-block;width:40px;height:40px;">${DOG_SVGS[s.cell.dogKey]}</span>`;
        }
        return s.cell.symbol;
    }).join(' ');

    if (selected.length === 0) {
        hintEl.textContent = 'Tap 3 symbols to form a triad';
    } else if (selected.length === 1) {
        hintEl.textContent = 'Select 2 more...';
    } else if (selected.length === 2) {
        hintEl.textContent = 'Select 1 more to complete triad';
    } else {
        hintEl.textContent = 'Checking triad...';
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME END
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function endGame(won) {
    gameActive = false;
    if (timerInterval) clearInterval(timerInterval);

    if (won) {
        document.getElementById('level-stats').innerHTML = `
            Score: ${score}<br>
            Love Banked: ${bankedLove}<br>
            Coin Banked: ${bankedCoin}<br>
            Shadow Banked: ${bankedShadow}
        `;
        document.getElementById('fact-text').textContent = FACTS[Math.floor(Math.random() * FACTS.length)];
        document.getElementById('level-complete').classList.add('active');
    } else {
        document.getElementById('gameover-stats').innerHTML = `
            Level: ${level}<br>
            Score: ${score}<br>
            Love/Coin/Shadow: ${bankedLove}/${bankedCoin}/${bankedShadow}
        `;
        document.getElementById('game-over').classList.add('active');
    }
}

function nextLevel() {
    document.getElementById('level-complete').classList.remove('active');
    level++;
    timerMax = Math.max(6, 12 - level); // Timer gets shorter each level
    initLevel();
}

function restartGame() {
    document.getElementById('game-over').classList.remove('active');
    level = 1;
    score = 0;
    timerMax = 12;
    initLevel();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>

    <site-footer></site-footer>
</body>
</html>
